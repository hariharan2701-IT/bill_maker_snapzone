<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snapzone Frames - Professional Invoice Generator</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="background-pattern"></div>
  
  <div class="container">
    <div class="header">
      <div class="logo-section">
        <div class="logo-icon">
          <i class="fas fa-camera-retro"></i>
        </div>
        <div class="company-info">
          <h1>Snapzone Frames</h1>
          <p>Professional Photo Framing Services</p>
        </div>
      </div>
      <div class="invoice-badge">
        <i class="fas fa-file-invoice"></i>
        <span>Invoice Generator</span>
      </div>
    </div>

    <form id="billForm" class="invoice-form">
      <div class="form-section">
        <h3><i class="fas fa-info-circle"></i> Order Information</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="orderNumber">
              <i class="fas fa-hashtag"></i>
              Order Number
            </label>
            <input type="text" id="orderNumber" placeholder="e.g., ORD-2024-001" required />
          </div>
          <div class="form-group">
            <label for="orderDate">
              <i class="fas fa-calendar"></i>
              Order Date
            </label>
            <input type="date" id="orderDate" required />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i class="fas fa-user"></i> Customer Details</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="customerName">
              <i class="fas fa-user-circle"></i>
              Customer Name
            </label>
            <input type="text" id="customerName" placeholder="Enter full name" required />
          </div>
          <div class="form-group">
            <label for="phone">
              <i class="fas fa-phone"></i>
              Phone Number
            </label>
            <input type="tel" id="phone" placeholder="+91 XXXXX XXXXX" required />
          </div>
        </div>
        <div class="form-group">
          <label for="email">
            <i class="fas fa-envelope"></i>
            Email Address (Optional)
          </label>
          <input type="email" id="email" placeholder="customer@example.com" />
        </div>
        <div class="form-group">
          <label for="address">
            <i class="fas fa-map-marker-alt"></i>
            Complete Address
          </label>
          <textarea id="address" placeholder="Enter complete address with pincode" rows="3" required></textarea>
        </div>
      </div>

      <div class="form-section">
        <h3><i class="fas fa-cog"></i> Service Details</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="coimbatore">
              <i class="fas fa-map"></i>
              Within Coimbatore?
            </label>
            <select id="coimbatore">
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="form-group">
            <label for="courier">
              <i class="fas fa-shipping-fast"></i>
              Courier Required?
            </label>
            <select id="courier" onchange="updateTotal()">
              <option value="No">No</option>
              <option value="Yes">Yes (+₹70)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i class="fas fa-frame"></i> Frame Details</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="frameSize">
              <i class="fas fa-expand-arrows-alt"></i>
              Frame Size
            </label>
            <input type="text" id="frameSize" placeholder="e.g., 8x10, A4, 12x18" required />
          </div>
          <div class="form-group">
            <label for="frameType">
              <i class="fas fa-palette"></i>
              Frame Type
            </label>
            <select id="frameType">
              <option value="Standard">Standard Frame</option>
              <option value="Premium">Premium Frame</option>
              <option value="Luxury">Luxury Frame</option>
              <option value="Custom">Custom Frame</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="frameAmount">
              <i class="fas fa-rupee-sign"></i>
              Frame Amount
            </label>
            <input type="number" id="frameAmount" placeholder="0" min="0" step="1" onchange="updateTotal()" required />
          </div>
          <div class="form-group">
            <label for="quantity">
              <i class="fas fa-sort-numeric-up"></i>
              Quantity
            </label>
            <input type="number" id="quantity" value="1" min="1" onchange="updateTotal()" required />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i class="fas fa-calculator"></i> Payment Summary</h3>
        <div class="payment-summary">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span id="subtotal">₹0</span>
          </div>
          <div class="summary-row">
            <span>Courier Charges:</span>
            <span id="courierCharges">₹0</span>
          </div>
          <div class="summary-row total-row">
            <span>Grand Total:</span>
            <span id="grandTotal">₹0</span>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" onclick="previewInvoice()" class="btn-secondary">
          <i class="fas fa-eye"></i>
          Preview Invoice
        </button>
        <button type="button" onclick="generatePDF()" class="btn-primary">
          <i class="fas fa-download"></i>
          Download PDF Invoice
        </button>
      </div>
    </form>
  </div>

  <!-- Preview Modal -->
  <div id="previewModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Invoice Preview</h3>
        <span class="close" onclick="closePreview()">&times;</span>
      </div>
      <div id="previewContent" class="modal-body">
        <!-- Preview content will be inserted here -->
      </div>
      <div class="modal-footer">
        <button onclick="closePreview()" class="btn-secondary">Close</button>
        <button onclick="generatePDF()" class="btn-primary">Download PDF</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    window.onload = () => {
      // Set today's date as default
      document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
      
      // Initialize total calculation
      updateTotal();

      // Add input event listeners for real-time updates
      document.getElementById('frameAmount').addEventListener('input', updateTotal);
      document.getElementById('quantity').addEventListener('input', updateTotal);
      document.getElementById('courier').addEventListener('change', updateTotal);

      // Phone number formatting
      document.getElementById('phone').addEventListener('input', function(e) {
        let input = e.target.value;
        
        // Remove all non-digits
        let digits = input.replace(/\D/g, '');
        
        // Limit to 10 digits (Indian mobile number)
        if (digits.length > 10) {
          digits = digits.slice(0, 10);
        }
        
        // Format the number
        let formatted = '';
        if (digits.length > 0) {
          formatted = '+91 ';
          if (digits.length <= 5) {
            formatted += digits;
          } else {
            formatted += digits.slice(0, 5) + ' ' + digits.slice(5);
          }
        }
        
        e.target.value = formatted;
        
        // Format the number
        let formatted = '';
        if (digits.length > 0) {
          formatted = '+91 ';
          if (digits.length <= 5) {
            formatted += digits;
          } else {
            formatted += digits.slice(0, 5) + ' ' + digits.slice(5);
          }
        }
        
        e.target.value = formatted;
      });
    };

    function updateTotal() {
      const frameAmount = parseInt(document.getElementById('frameAmount').value) || 0;
      const quantity = parseInt(document.getElementById('quantity').value) || 1;
      const courier = document.getElementById('courier').value;
      
      const subtotal = frameAmount * quantity;
      const courierCharge = courier === 'Yes' ? 70 : 0;
      const grandTotal = subtotal + courierCharge;
      
      document.getElementById('subtotal').textContent = `₹${subtotal}`;
      document.getElementById('courierCharges').textContent = `₹${courierCharge}`;
      document.getElementById('grandTotal').textContent = `₹${grandTotal}`;
    }

    function validateForm() {
      const requiredFields = ['orderNumber', 'orderDate', 'customerName', 'phone', 'address', 'frameSize', 'frameAmount'];
      const errors = [];
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
          errors.push(`${field.previousElementSibling.textContent.replace('*', '')} is required`);
          field.style.borderColor = '#ef4444';
        } else {
          field.style.borderColor = '#e2e8f0';
        }
      });
      
      // Validate phone number
      const phone = document.getElementById('phone').value;
      if (phone && !phone.match(/^\+91\s\d{5}(\s\d{1,5})?$/)) {
        errors.push('Please enter a valid phone number');
        document.getElementById('phone').style.borderColor = '#ef4444';
      }
      
      // Validate frame amount
      const frameAmount = parseInt(document.getElementById('frameAmount').value);
      if (frameAmount <= 0) {
        errors.push('Frame amount must be greater than 0');
        document.getElementById('frameAmount').style.borderColor = '#ef4444';
      }
      
      if (errors.length > 0) {
        alert('Please fix the following errors:\n\n' + errors.join('\n'));
        return false;
      }
      
      return true;
    }

    function getFormData() {
      return {
        orderNumber: document.getElementById('orderNumber').value,
        orderDate: document.getElementById('orderDate').value,
        customerName: document.getElementById('customerName').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        address: document.getElementById('address').value,
        coimbatore: document.getElementById('coimbatore').value,
        courier: document.getElementById('courier').value,
        frameSize: document.getElementById('frameSize').value,
        frameType: document.getElementById('frameType').value,
        frameAmount: parseInt(document.getElementById('frameAmount').value),
        quantity: parseInt(document.getElementById('quantity').value),
        subtotal: parseInt(document.getElementById('frameAmount').value) * parseInt(document.getElementById('quantity').value),
        courierCharge: document.getElementById('courier').value === 'Yes' ? 70 : 0,
        grandTotal: (parseInt(document.getElementById('frameAmount').value) * parseInt(document.getElementById('quantity').value)) + (document.getElementById('courier').value === 'Yes' ? 70 : 0)
      };
    }

    function previewInvoice() {
      if (!validateForm()) return;
      
      const data = getFormData();
      const previewContent = document.getElementById('previewContent');
      
      previewContent.innerHTML = `
        <div class="preview-invoice">
          <div class="preview-header">
            <h2>📸 Snapzone Frames</h2>
            <p>Professional Photo Framing Services</p>
            <p><strong>Invoice #${data.orderNumber}</strong></p>
            <p>Date: ${new Date(data.orderDate).toLocaleDateString('en-IN')}</p>
          </div>
          
          <div class="preview-section">
            <h4>Customer Information</h4>
            <div class="preview-row"><span>Name:</span><span>${data.customerName}</span></div>
            <div class="preview-row"><span>Phone:</span><span>${data.phone}</span></div>
            ${data.email ? `<div class="preview-row"><span>Email:</span><span>${data.email}</span></div>` : ''}
            <div class="preview-row"><span>Address:</span><span>${data.address}</span></div>
            <div class="preview-row"><span>Within Coimbatore:</span><span>${data.coimbatore}</span></div>
          </div>
          
          <div class="preview-section">
            <h4>Service Details</h4>
            <div class="preview-row"><span>Frame Size:</span><span>${data.frameSize}</span></div>
            <div class="preview-row"><span>Frame Type:</span><span>${data.frameType}</span></div>
            <div class="preview-row"><span>Quantity:</span><span>${data.quantity}</span></div>
            <div class="preview-row"><span>Unit Price:</span><span>₹${data.frameAmount}</span></div>
            <div class="preview-row"><span>Courier Required:</span><span>${data.courier}</span></div>
          </div>
          
          <div class="preview-total">
            <div class="preview-row"><span>Subtotal:</span><span>₹${data.subtotal}</span></div>
            <div class="preview-row"><span>Courier Charges:</span><span>₹${data.courierCharge}</span></div>
            <div class="preview-row" style="font-weight: bold; font-size: 1.1em; color: #2563eb;">
              <span>Grand Total:</span><span>₹${data.grandTotal}</span>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('previewModal').style.display = 'block';
    }

    function closePreview() {
      document.getElementById('previewModal').style.display = 'none';
    }

    function generatePDF() {
      if (!validateForm()) return;
      
      // Check if jsPDF is loaded
      if (typeof window.jspdf === 'undefined') {
        alert('PDF library is loading... Please try again in a moment.');
        return;
      }
      
      const { jsPDF } = window.jspdf;
      const data = getFormData();
      const doc = new jsPDF();
      
      // Set up colors
      const primaryColor = [37, 99, 235];
      const textColor = [30, 41, 59];
      const lightGray = [148, 163, 184];
      const darkGray = [75, 85, 99];
      
      // Header with company branding
      doc.setFillColor(...primaryColor);
      doc.rect(0, 0, 210, 45, 'F');
      
      // Company name and details in header
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(22);
      doc.setFont('helvetica', 'bold');
      doc.text('SNAPZONE FRAMES', 20, 20);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      doc.text('Professional Photo Framing Services', 20, 28);
      doc.text('Phone: +91 77085 54879 / +91 94836 92989', 20, 35);
      doc.text('Email: info@snapzoneframes.com', 20, 42);
      
      // Invoice details in header
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(16);
      doc.setFont('helvetica', 'bold');
      doc.text('INVOICE', 150, 20);
      
      doc.setFontSize(12);
      doc.setFont('helvetica', 'normal');
      doc.text(`Invoice #: ${data.orderNumber}`, 150, 30);
      doc.text(`Date: ${new Date(data.orderDate).toLocaleDateString('en-IN')}`, 150, 38);
      
      // Reset text color for body
      doc.setTextColor(...textColor);
      
      let yPos = 65;
      
      // Bill To Section
      doc.setFontSize(16);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(...primaryColor);
      doc.text('BILL TO:', 20, yPos);
      
      yPos += 8;
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(...textColor);
      
      // Customer name in bold
      doc.setFont('helvetica', 'bold');
      doc.text(data.customerName, 20, yPos);
      yPos += 6;
      
      doc.setFont('helvetica', 'normal');
      doc.text(data.phone, 20, yPos);
      yPos += 6;
      
      if (data.email) {
        doc.text(data.email, 20, yPos);
        yPos += 6;
      }
      
      // Split address into multiple lines if too long
      const addressLines = doc.splitTextToSize(data.address, 80);
      addressLines.forEach(line => {
        doc.text(line, 20, yPos);
        yPos += 6;
      });
      
      doc.text(`Location: ${data.coimbatore === 'Yes' ? 'Within Coimbatore' : 'Outside Coimbatore'}`, 20, yPos);
      
      yPos += 15;
      
      // Service Details Table Header
      doc.setFillColor(240, 240, 240);
      doc.rect(20, yPos - 5, 170, 12, 'F');
      
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(...primaryColor);
      doc.text('SERVICE DETAILS', 25, yPos + 2);
      
      yPos += 15;
      
      // Table headers
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(...darkGray);
      doc.text('DESCRIPTION', 25, yPos);
      doc.text('SIZE', 90, yPos);
      doc.text('QTY', 120, yPos);
      doc.text('UNIT PRICE', 140, yPos);
      doc.text('AMOUNT', 170, yPos);
      
      yPos += 8;
      
      // Draw line under headers
      doc.setDrawColor(...lightGray);
      doc.setLineWidth(0.5);
      doc.line(20, yPos - 2, 190, yPos - 2);
      
      yPos += 5;
      
      // Service details row
      doc.setFontSize(10);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(...textColor);
      
      doc.text(`${data.frameType} Frame`, 25, yPos);
      doc.text(data.frameSize, 90, yPos);
      doc.text(data.quantity.toString(), 120, yPos);
      doc.text(`₹${data.frameAmount}`, 140, yPos);
      doc.text(`₹${data.subtotal}`, 170, yPos);
      
      yPos += 8;
      
      // Courier service if applicable
      if (data.courier === 'Yes') {
        doc.text('Courier Service', 25, yPos);
        doc.text('-', 90, yPos);
        doc.text('1', 120, yPos);
        doc.text('₹70', 140, yPos);
        doc.text('₹70', 170, yPos);
        yPos += 8;
      }
      
      // Draw line above totals
      doc.line(120, yPos, 190, yPos);
      yPos += 8;
      
      // Subtotal
      doc.setFont('helvetica', 'normal');
      doc.text('Subtotal:', 140, yPos);
      doc.text(`₹${data.subtotal}`, 170, yPos);
      yPos += 6;
      
      // Courier charges
      doc.text('Courier Charges:', 140, yPos);
      doc.text(`₹${data.courierCharge}`, 170, yPos);
      yPos += 8;
      
      // Total with background
      doc.setFillColor(...primaryColor);
      doc.rect(120, yPos - 5, 70, 12, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(12);
      doc.text('TOTAL:', 125, yPos + 2);
      doc.text(`₹${data.grandTotal}`, 170, yPos + 2);
      
      yPos += 20;
      
      // Terms and conditions section
      doc.setTextColor(...textColor);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text('TERMS & CONDITIONS:', 20, yPos);
      
      yPos += 8;
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      const terms = [
        '• Payment is due within 30 days of invoice date',
        '• All frames are custom made and non-returnable',
        '• Delivery time: 7-10 working days for standard frames',
        '• Customer is responsible for providing high-quality images'
      ];
      
      terms.forEach(term => {
        doc.text(term, 20, yPos);
        yPos += 6;
      });
      
      yPos += 8;
      
      // Footer
      doc.setTextColor(...primaryColor);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text('Thank you for choosing Snapzone Frames!', 20, yPos);
      
      yPos += 6;
      doc.setTextColor(...textColor);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text('We appreciate your business and look forward to serving you again.', 20, yPos);
      
      // Add page border
      doc.setDrawColor(...lightGray);
      doc.setLineWidth(1);
      doc.rect(15, 50, 180, yPos - 40);
      
      // Save the PDF
      const fileName = `Snapzone_Invoice_${data.orderNumber}_${data.customerName.replace(/\s+/g, '_')}.pdf`;
      doc.save(fileName);
      
      // Close preview modal if open
      closePreview();
      
      // Show success message
      setTimeout(() => {
        alert('✅ Invoice generated successfully!\n\nThe PDF has been downloaded to your device.');
      }, 500);
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('previewModal');
      if (event.target === modal) {
        closePreview();
      }
    }

    // Make functions globally available
    window.updateTotal = updateTotal;
    window.previewInvoice = previewInvoice;
    window.generatePDF = generatePDF;
    window.closePreview = closePreview;
  </script>
  <script type="module" src="/main.js"></script>
</body>
</html>